---
title: Device connectivity in Azure IoT Central | Microsoft Docs
description: This article introduces key concepts relating to device connectivity in Azure IoT Central
author: dominicbetts
ms.author: dobett
ms.date: 11/30/2017
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: timlt
---
# Device connectivity in Azure IoT Central

This article introduces key concepts that relate to device connectivity in Microsoft Azure IoT Central.

Azure IoT Central uses [Azure IoT Hub Device Provisioning Service](https://docs.microsoft.com/azure/iot-dps/about-iot-dps) to register and connect devices at scale.

With Device Provisioning Service:

- Customers can now generate device credentials and configure devices offline without having to first register the devices in Azure IoT Central.
- Azure IoT Central supports device connection with X.509 certificates, while continuing to support and improve connectivity with shared access signatures.
- Azure IoT Central customers can now use their own device IDs to register devices in Azure IoT Central, which enables simple integration with existing back-office systems.
- There's one consistent way to connect devices to Azure IoT Central.

>[!NOTE]
>Azure IoT Central uses IoT Hub Device Provisioning Service for all device registration and connection. [Learn more](https://docs.microsoft.com/azure/iot-dps/about-iot-dps).

Based on your use case, follow the appropriate instructions to connect devices to Azure IoT Central:

- [Connect a single device quickly (by using shared access signatures)](#connect-a-single-device)
- [Connect devices at scale by using shared access signatures](#connect-devices-at-scale-using-shared-access-signatures)
- [Connect devices at scale by using X.509 certificates](#connect-devices-using-x509-certificates) (recommended for production workloads)
- [Connect without first registering devices](#connect-without-first-registering-devices) 

>[!NOTE]
>The global end point for devices to connect and provision is **global.azure-devices-provisioning.net**.

## Connect a single device

To connect a single device to Azure IoT Central by using shared access signatures:

1. Add a **real device** from **Device Explorer**. Select **+New** > **Real** to add a real device.
    - Enter the **Device ID** (should be lowercase) or use the suggested device ID.
    - Enter the **Device Name** or use the suggested name.

    ![Add Device](media/concepts-connectivity/add-device.png)

1. Get the connection details, like the **Scope ID**, **Device ID**, and **Primary Key**, for the added device by selecting **Connect** on the device page.

    - **[Scope ID](https://docs.microsoft.com/azure/iot-dps/concepts-device#id-scope)** is per Azure IoT Central app and is generated by Device Provisioning Service. This ID is used to ensure a unique device ID within an app.
    - **Device ID** is the unique device ID per app. The device needs to send the device ID as part of the registration call.
    - **Primary Key** is a shared access signature token, generated by Azure IoT Central for this specific device.
 
    ![Connection details](media/concepts-connectivity/device-connect.png)

1. Use the connection details **Device Identity**, **Device Name**, and the device's **Primary Key** in your device code to provision and connect your device and start seeing the data flow through instantaneously. If you're using a MXChip IoT DevKit (DevKit) device, follow [the step-by-step instructions](howto-connect-devkit-experimental.md#add-a-real-device), starting from the section "Prepare the DevKit device."

    Here are the references for other languages you might want to use.

    - **C language:** Follow [this C sample device client](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md) to connect a sample device. Use the following settings in the sample:

         ```c
         hsm_type = SECURE_DEVICE_TYPE_SYMMETRIC_KEY;

         ## Enter the Device Id and Symmetric keys 
         prov_dev_set_symmetric_key_info("<Device Id>", "<Enter Primary Symmetric key here>");
        ```

    - **Node.js:**  Follow [the step-by-step instructions](tutorial-add-device-experimental.md#prepare-the-client-code), starting from the section "Prepare the client code."

## Connect devices at scale by using shared access signatures

To connect devices at scale with Azure IoT Central by using shared access signatures, there are two overall steps:

1. **Device registration:** Register the devices by importing them into Azure IoT Central via a CSV file. Then use the **Export** action to export your devices and get their device-connection details.
1. **Device setup:** Program the devices with the connection details (**Scope ID**, **Device ID**, and **Primary Key**). When each device is switched on, it will call Device Provisioning Service to get its connection information or Azure IoT Central app assignment.

>[!NOTE]
>An advanced option is also available where you can connect devices without having to first register the devices in Azure IoT Central. [Learn more](https://docs.microsoft.com/azure/iot-dps/about-iot-dps).

### Device registration

To connect a large number of devices to your application, Azure IoT Central supports bulk importing of devices via a CSV file. 

1. Import devices to register them in your application:

   1. Select **Device Explorer** on the left menu.
   1. On the left panel, select the device template for which you want to bulk create the devices. 
   1. Select **Import**, and then select the CSV file that has the list of Device IDs to be imported. The CSV file should have the following columns (and headers):

       - IOTC_DeviceID (should be lowercase)
       - IOTC_DeviceName (optional)

   1. After the import is finished, a success message is shown on the device grid.

1. Export devices to get their connection details:

   The **Export** action creates a CSV file with the device ID, the device name, and the device keys. Use these details to connect the device to Azure IoT Central. To bulk-export devices from your application:

   1. Select **Device Explorer** on the left menu.
   1. Select the devices that you want to export, and then select the **Export** action.
   1. After the export is finished, a success message is shown along with a link to download the generated file.
   1. Click the success message to download the file to a local folder on the disk.
   1. The exported CSV file will have the following columns that contain the connection details **Device ID**, **Device Name**, **Device Primary or Secondary Keys**, and **Primary or Secondary certificate thumbprints**:

       - IOTC_DEVICEID
       - IOTC_DEVICENAME
       - IOTC_SASKEY_PRIMARY
       - IOTC_SASKEY_SECONDARY
       - IOTC_X509THUMBPRINT_PRIMARY
       - IOTC_X509THUMBPRINT_SECONDARY

### Device setup

 To provision and connect your device, use the connection details **Device Identity (IOTC_DEVICEID)**, **Device Primary Key (IOTC_SASKEY_PRIMARY)**, and **Scope ID** in your device code. If you haven't already done so, get the **Scope ID** from your Azure IoT Central app by selecting **Administration** > **Device Connection** > **Scope ID**.

If you're connecting a DevKit device, follow [the step-by-step instructions](howto-connect-devkit-experimental.md#add-a-real-device), starting from the section "Prepare the DevKit device."

Here are the references for other languages you might want to use.

- **C language:** Follow [this C sample device client](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md) to connect a sample device. Use the following settings in the sample:

     ```c
     hsm_type = SECURE_DEVICE_TYPE_SYMMETRIC_KEY;

     ## Enter the Device Id and Symmetric keys 
     prov_dev_set_symmetric_key_info("<Device Id>", "<Enter Primary Symmetric key here>");
    ```

- **Node.js:** Follow [the step-by-step instructions](tutorial-add-device-experimental.md#prepare-the-client-code), starting from the section "Prepare the client code."

## Connect devices by using X.509 certificates

Using X.509 certificates as an attestation mechanism is an excellent way to scale production and simplify device provisioning. X.509 certificates are typically arranged in a certificate chain of trust, in which each certificate in the chain is signed by the private key of the next higher certificate, and so on, ending in a self-signed root certificate. This structure establishes a delegated chain of trust from the root certificate that's generated by a trusted root-certificate authority (CA) down through each intermediate CA to the end-entity "leaf" certificate that's installed on a device. To learn more, see [Device authentication by using X.509 CA certificates](https://docs.microsoft.com/azure/iot-hub/iot-hub-x509ca-overview). 

To connect devices to Azure IoT Central by using X.509 certificates, there are three key steps involved:
 
1. **Configure the connection settings** in the Azure IoT Central app by adding or verifying the X.509 root or intermediate certificate that's used to generate the device certificates. There are three steps to configure the connection settings for X.509 certificates:  

    - **Add the X.509 root or intermediate certificate** that you're using to generate the leaf device certificates. Go to **Administration** > **Device Connection** > **Certificates**. 
    
       ![Connection settings](media/concepts-connectivity/connection-settings.png)

    - **Verify the certificate.** Verifying certificate ownership ensures that the uploader of the certificate has the certificate's private key. To verify the certificate:

        - Generate the verification code. Select the button next to the **Verification Code** field to generate this code. 
        - Create an X.509 verification certificate with the verification code. Save the certificate as a .cer file. 
        - Upload the signed verification certificate, and select **Verify**.

        ![Connection settings](media/concepts-connectivity/verify-cert.png)

    - **Add a secondary certificate.** During the lifecycle of your IoT solution, you'll need to roll certificates. Two of the main reasons for rolling certificates are security breaches and certificate expirations. Secondary certificates reduce downtime for devices that are attempting to provision while you're updating the primary certificate.

      **For testing purposes only:**
    
      Here are some utility command-line tools you can use to generate CA certificates and device certificates.

      - If you're using a DevKit device, here is a [command-line tool](https://aka.ms/iotcentral-docs-dicetool) to generate CA certificates. Add it to your Azure IoT Central app and verify the certificates. 

      - Use [this command-line tool](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to:

          - Create the certificate chain (follow step 2 in the GitHub docs). Save the certificates as .cer files and upload them to Azure IoT Central (as primary certificates).
          - Get the verification code from the Azure IoT Central app, generate the certificate (follow step 3 in the GitHub docs), and upload the certificate to verify it. 
          - Create leaf certificates with your device ID as a parameter to the tool (follow step 4). Save the certificate and use it on your device.

1. **Register devices** by importing them into Azure IoT Central via a CSV file.

1. **Device setup**: Generate the leaf certificates by using the uploaded root certificate. Make sure you use the device ID as the CNAME in the leaf certificates and make sure it is in lowercase. Here is a [command-line tool](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to generate leaf/device certificates for **testing purposes only**.

1. **Program the device with provisioning service information**, enabling it to get its connection details and its Azure IoT Central app assignment when it's switched on.

    For more information, see these articles:

    - [Sample implementation for Raspberry Pi](https://aka.ms/iotcentral-docs-Raspi-releases)  

    - [Sample device client in C](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md)

## Connect without first registering devices

One of the key scenarios Azure IoT Central supports is for OEMs to mass-manufacture devices, generate credentials, and configure the devices in the factory without having to first register the devices in Azure IoT Central. After the devices are turned on and they attempt to connect to Azure IoT Central, the operator approves the devices to connect to the Azure IoT Central app.

Here is the flow to connect devices with this feature:

![Connection settings](media/concepts-connectivity/device-connection-flow.png)

Follow the steps based on your choice of device-authentication scheme (X.509 certificates or shared access signatures):

1. **Configure or get the connection settings:**

    - **X.509 certificates:** [Add and verify the root or intermediate certificate](#connect-devices-using-x509-certificates) and use it to generate the device certificates in the next step.
    - **Shared access signatures:** Copy the primary key (this key is the group shared access signature key for this Azure IoT Central application) and use it to generate the device shared access signature keys in the next step.

       ![Connection settings for shared access signatures](media/concepts-connectivity/connection-settings-sas.png)

1. **Generate the device credentials:**

    - **X.509 certificates:** Generate the leaf certificates for your devices by using the root or intermediate certificate you've added to this app. Make sure you use the device ID as a CNAME in the leaf certificates and make sure it's lowercase. Here is a [command-line tool](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to generate leaf/device certificates for testing.
    - **Shared access signatures:** To generate device shared access signature keys, use this [command-line tool](https://www.npmjs.com/package/dps-keygen). Use the primary shared access signature key (group shared access signature key) from the previous step. Make sure the device ID is in lowercase.

        Use the following command to get the device's connection string: 

        ```
        npm i -g dps-keygen
        ```
    
        Use the following command to generate a device shared access signature key:
                        
        ```
        dps-keygen <Primary_Key(GroupSAS)> <device_id>
        ```

1. **Set up the devices:** Flash each device with the **Scope ID**, **Device ID**, and **Device certificate/SAS key**, and then turn on the device to connect it to the Azure IoT Central app.

1. **Connect the devices to Azure IoT Central:** After the devices are switched on, they connect to Device Provisioning Service/Azure IoT Central for registration.

1. **Associate the devices to a template:** The connected devices show up under **Un-Associated devices** in **Device Explorer**. Their device provisioning status is **Registered**. **Associate** the devices to the appropriate device template and approve the devices to connect to the Azure IoT Central app. The devices get the connection details for the Azure IoT Central app, and then they connect and start sending data. Device provisioning is now finished, and the **Provisioning status** for the devices turns to **Provisioned**.

## Device provisioning status

When a real device is connected to Azure IoT Central, the following steps occur:

1. **Registered**: The device is first registered, meaning the device is created in Azure IoT Central, and it has the device ID for the device. A device is registered when:

    * A new real device is added in **Device Explorer**
    * A set of devices is added by using **Import** in **Device Explorer**
    * A device that hasn't been registered connects with valid credentials and is visible under **Un-Associated devices**

    In all the above cases, the **Provisioning status** is **Registered**.

1. **Provisioned**: When the device connects with valid credentials, Azure IoT Central completes the provisioning step (by creating the device in IoT Hub). Azure IoT Central then returns the connection string to the device so it can connect and start sending data. The device's **Provisioning status** turns from **Registered** to **Provisioned**.

1. **Blocked**: The operator can block a device. After a device is blocked, it can't send data to Azure IoT Central and it will have to be reset. Devices that are blocked have the **Provisioning status** of **Blocked**. The operator can also unblock the device. After it's unblocked, the device's **Provisioning status** returns to its previous status (**Registered** or **Provisioned**). 

## Get the device connection string

You can get the Iot Hub device connection string to Azure IoT Hub by using the following steps:

1. Get the device's connection details, like the **Scope ID**, **Device ID**, and **Primary Key** from the **Device Connection** page. To get these details, go to the **Device** page and select **Connect**. 

    ![Connection details](media/concepts-connectivity/device-connect.png)

1. Get the device's connection string by using the dps-keygen command-line tool. Use the following command to get the device's connection string:  

    ```cmd/sh
    npm i -g dps-keygen
    ```

    To create a connection string, find the binary under the *bin/* folder:

    ```cmd/sh
    dps_cstr <scope_id> <device_id> <Primary Key(for device)>
    ```

    [Learn more about the dps-keygen tool](https://www.npmjs.com/package/dps-keygen).

## SDK support

The Azure IoT SDKs offer the easiest way for you to use the code on your devices that connect to your Azure IoT Central application. The following SDKs are available:

- [Azure IoT SDK for C](https://github.com/azure/azure-iot-sdk-c)
- [Azure IoT SDK for Python](https://github.com/azure/azure-iot-sdk-python)
- [Azure IoT SDK for Node.js](https://github.com/azure/azure-iot-sdk-node)
- [Azure IoT SDK for Java](https://github.com/azure/azure-iot-sdk-java)
- [Azure IoT SDK for .NET](https://github.com/azure/azure-iot-sdk-csharp)

Each device connects by using a unique connection string that identifies the device. A device can connect only to the IoT hub where it's registered. When you create a real device in your Azure IoT Central application, the application generates a connection string for you to use.

## SDK features and IoT Hub connectivity

All device communication with IoT Hub uses the following IoT Hub connectivity options:

- [Device-to-cloud messaging](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c)
- [Device twins](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-device-twins)

The following table summarizes how Azure IoT Central device features map to IoT Hub features:

| Azure IoT Central | Azure IoT Hub |
| ----------- | ------- |
| Measurement: Telemetry | Device-to-cloud messaging |
| Device properties | Device twin reported properties |
| Settings | Device twin desired and reported properties |

To learn more about using the Azure IoT SDKs, see the following articles for sample code:

- [Connect a generic Node.js client to your Azure IoT Central application](howto-connect-nodejs-experimental.md)
- [Connect a Raspberry Pi device to your Azure IoT Central application](howto-connect-raspberry-pi-python.md)
- [Connect a MXChip IoT DevKit device to your Azure IoT Central application](howto-connect-devkit-experimental.md)


## Protocols

The Azure IoT SDKs support the following network protocols for connecting to an IoT hub:

- MQTT
- AMQP
- HTTPS

For information about these protocols and guidance on choosing one, see [Choose a communication protocol](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-protocols).

If your device can't use any of the supported protocols, you can use Azure IoT Edge to do protocol conversion. IoT Edge supports other intelligence-on-the-edge scenarios to offload processing to the edge from the Azure IoT Central application.

## Security

All data exchanged between devices and your Azure IoT Central app is encrypted. IoT Hub authenticates every request from a device that connects to any of the device-facing IoT Hub endpoints. To avoid exchanging credentials over the wire, a device uses signed tokens to authenticate. For more information, see [Control access to IoT Hub](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-security).

## Next steps

- [Prepare and connect a MXChip IoT DevKit device](howto-connect-devkit-experimental.md)
- [Prepare and connect a Raspberry Pi device](howto-connect-raspberry-pi-python.md)
- [Connect a generic Node.js client to your Azure IoT Central application](howto-connect-nodejs-experimental.md)
